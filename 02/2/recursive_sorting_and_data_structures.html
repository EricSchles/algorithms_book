
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recursive Sorting And Data Structures &#8212; The Analysis Of Algorithms</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Basic Sorting" href="../1/basic_sorting_and_recursion.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      <h1 class="site-logo" id="site-title">The Analysis Of Algorithms</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../plan.html">
   Analysis Of Algorithms
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../01/chapter_one_intro.html">
   Algorithms Foundations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/1/Introduction_to_Python.html">
     Introduction To Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/2/Introduction_To_Proofs.html">
     Introduction To Proofs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/3/Counterexamples_and_Testing.html">
     Counter Examples and Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/4/Types_and_Induction.html">
     Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/5/First_Algorithms.html">
     First Algorithms
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../chapter_2_intro.html">
   Chapter 2
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../1/basic_sorting_and_recursion.html">
     Basic Sorting
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Recursive Sorting And Data Structures
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/02/2/recursive_sorting_and_data_structures.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/02/2/recursive_sorting_and_data_structures.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#merge-sort">
   Merge Sort
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="recursive-sorting-and-data-structures">
<h1>Recursive Sorting And Data Structures<a class="headerlink" href="#recursive-sorting-and-data-structures" title="Permalink to this headline">¶</a></h1>
<p>Now that we have the basics for sorting down, let’s move onto some more advanced algorithms.  As said in the last section, these algorithms will rely on recursion to sort the elements of the array in question.  Unfortunately, we will not be able to present an analysis of these algorithms in this section, for that we will require a new set of analysis tools, which we will see in the next section.</p>
<div class="section" id="merge-sort">
<h2>Merge Sort<a class="headerlink" href="#merge-sort" title="Permalink to this headline">¶</a></h2>
<p>The merge sort algorithm will be the first we see that gets used often in industry.  It is of a class of algorithms called divide and conquer, where first we divide the input up into parts, then process the input, then glue the input back together.  The merge sort algorithm does much more than just give us a new way to sort, it gives us a new framework for how to <em>think</em> about computation and programming.  Let’s look at an implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">left_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">right_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">left_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="ow">and</span> <span class="n">right_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">):</span>
        <span class="n">left_element</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">left_index</span><span class="p">]</span>
        <span class="n">right_element</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">right_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">left_element</span> <span class="o">&lt;=</span> <span class="n">right_element</span><span class="p">:</span>
            <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_element</span><span class="p">)</span>
            <span class="n">left_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_element</span><span class="p">)</span>
            <span class="n">right_index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">final</span> <span class="o">+=</span> <span class="n">left</span><span class="p">[</span><span class="n">left_index</span><span class="p">:]</span>
    <span class="n">final</span> <span class="o">+=</span> <span class="n">right</span><span class="p">[</span><span class="n">right_index</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">final</span>

<span class="k">def</span> <span class="nf">merge_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="n">mid_point</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    
    <span class="n">left</span> <span class="o">=</span> <span class="n">merge_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="n">mid_point</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">merge_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">mid_point</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_merge_sort</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="n">sorted_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="n">sorted_array</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">merge_sort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">sorted_array</span>
    
<span class="n">test_merge_sort</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>While at first this code may seem kinda nuts, like why would this possibly work?  But once we analyze it, it should at least be somewhat clearer.</p>
<p>Let’s begin with the steps we from last time -</p>
<ol class="simple">
<li><p>Find the point of comparison</p></li>
<li><p>Find the swap</p></li>
</ol>
<p>You may be tempted to look at the merge_sort procedure for this, but alas there is no comparison or swapping here.  The actual sorting all happens in the <code class="docutils literal notranslate"><span class="pre">merge</span></code> function defined first.</p>
<p>Since the comparison and swap happen pretty close by it’s easier to just show you the merge function and then point out where comparison and swap are happening:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span>  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="mi">2</span>     <span class="n">left_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="mi">3</span>     <span class="n">right_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="mi">4</span>     <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>
<span class="mi">5</span>     <span class="k">while</span> <span class="n">left_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="ow">and</span> <span class="n">right_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">):</span>
<span class="mi">6</span>         <span class="n">left_element</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">left_index</span><span class="p">]</span>
<span class="mi">7</span>         <span class="n">right_element</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">right_index</span><span class="p">]</span>
<span class="mi">8</span>         <span class="k">if</span> <span class="n">left_element</span> <span class="o">&lt;=</span> <span class="n">right_element</span><span class="p">:</span>
<span class="mi">9</span>             <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_element</span><span class="p">)</span>
<span class="mi">10</span>            <span class="n">left_index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="mi">11</span>        <span class="k">else</span><span class="p">:</span>
<span class="mi">12</span>            <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_element</span><span class="p">)</span>
<span class="mi">13</span>            <span class="n">right_index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="mi">14</span>    <span class="n">final</span> <span class="o">+=</span> <span class="n">left</span><span class="p">[</span><span class="n">left_index</span><span class="p">:]</span>
<span class="mi">15</span>    <span class="n">final</span> <span class="o">+=</span> <span class="n">right</span><span class="p">[</span><span class="n">right_index</span><span class="p">:]</span>
<span class="mi">16</span>    <span class="k">return</span> <span class="n">final</span>
</pre></div>
</div>
<p>The key to understanding the <code class="docutils literal notranslate"><span class="pre">merge</span></code> function is understanding <em>what it returns</em>.  As you can see <code class="docutils literal notranslate"><span class="pre">merge</span></code> returns <code class="docutils literal notranslate"><span class="pre">final</span></code>.  The <code class="docutils literal notranslate"><span class="pre">final</span></code> array stores the elements from the two subarrays, <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> in <em>sorted order</em>.  So as we append to final, we do so such that elements are only appended if they are done so such that the <em>next smallest element from either array</em> is added.  This is how we guarantee that the returned array <code class="docutils literal notranslate"><span class="pre">final</span></code> is sorted.  With that as context, let’s look at the comparison.</p>
<p>On line 8, 11, 14 and 15 the comparison happens.</p>
<p>Let’s start with line 8 since it’s the most explicit.</p>
<p>We have:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">left_element</span> <span class="o">&lt;=</span> <span class="n">right_element</span><span class="p">:</span>
    <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_element</span><span class="p">)</span>
    <span class="n">left_index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_element</span><span class="p">)</span>
    <span class="n">right_index</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Here we append the left element to the final array since it is less than ther right element.  On line 11 we see the else.  In this case, the right element is less, thus it gets appended to final.  The next comparison happens implicitly on lines 14 and 15:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">final</span> <span class="o">+=</span> <span class="n">left</span><span class="p">[</span><span class="n">left_index</span><span class="p">:]</span>
<span class="n">final</span> <span class="o">+=</span> <span class="n">right</span><span class="p">[</span><span class="n">right_index</span><span class="p">:]</span>
</pre></div>
</div>
<p>This is because we <em>start</em> with the left_index, so implicitly we are assuming that we’ve already made all the possible comparisons between the left and right sub arrays.  In fact, at this point of the code only <code class="docutils literal notranslate"><span class="pre">left</span></code> or <code class="docutils literal notranslate"><span class="pre">right</span></code> will be non-empty as the while loop in line 5 continues until <em>at least</em> one of the sub-arrays is empty.  If there are remaining elements to append to the final array they will <em>either</em> be in the left or right subarray.  Since there is no way to tell ahead of time which one will be non-empty we simply include both statements.  We could be explicit about this with a conditional, but appending the contents of an empty array to an array is just the original array, so there is no harm in just having <em>both</em> statements in the main context of the function.</p>
<p>Finally, we have to find the swaps.  The swaps occur implicitly at the point of appending to the final array.  So technically they happen here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">left_element</span> <span class="o">&lt;=</span> <span class="n">right_element</span><span class="p">:</span>
    <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_element</span><span class="p">)</span>
    <span class="n">left_index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_element</span><span class="p">)</span>
    <span class="n">right_index</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>And here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">final</span> <span class="o">+=</span> <span class="n">left</span><span class="p">[</span><span class="n">left_index</span><span class="p">:]</span>
<span class="n">final</span> <span class="o">+=</span> <span class="n">right</span><span class="p">[</span><span class="n">right_index</span><span class="p">:]</span>
</pre></div>
</div>
<p>We ‘swap’ implicitly by appending to a new array in sorted order, rather than swapping in place in the original array.  It is possible to rewrite merge sort such that it does explicit swaps rather than creating a new <code class="docutils literal notranslate"><span class="pre">final</span></code> array.  Doing this inplace would be more space efficient, but would make the code less readible which is why the above implementation was the one chosen.</p>
<p>Now that we’ve talked about the comparison and swapping, which shows us this is at least a <em>candidate</em> for a sorting algorithm, let’s talk about the <code class="docutils literal notranslate"><span class="pre">merge_sort</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="k">def</span> <span class="nf">merge_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
<span class="mi">2</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
<span class="mi">3</span>         <span class="k">return</span> <span class="n">arr</span>
<span class="mi">4</span>     <span class="n">mid_point</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
<span class="mi">5</span>    
<span class="mi">6</span>     <span class="n">left</span> <span class="o">=</span> <span class="n">merge_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="n">mid_point</span><span class="p">])</span>
<span class="mi">7</span>     <span class="n">right</span> <span class="o">=</span> <span class="n">merge_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">mid_point</span><span class="p">:])</span>
<span class="mi">8</span>     <span class="k">return</span> <span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>
</div>
<p>This is where the <em>divide and conquer</em> part of the algorithm happens.  Here we have a midpoint which <em>divides</em> the array into two equal or <em>nearly</em> equal sub-arrays and then sends them through a set of recursive calls.  Notice that we don’t return up back through the recursive call until after we’ve merged, thus we have a guarantee that any given left and right subarrays will <em>always</em> be sorted by the time they get to line 8.</p>
<p>If you recall from last lecture when we talked about the recursive implementation of fibonacci, it was possible to write down each of the recursive calls like so:</p>
<p><img alt="" src="../../_images/fib_1.png" />
<img alt="" src="../../_images/fib_2.png" />
<img alt="" src="../../_images/fib_3.png" />
<img alt="" src="../../_images/fib_4.png" />
<img alt="" src="../../_images/fib_5.png" />
<img alt="" src="../../_images/fib_fin.png" /></p>
<p>As you can see the way the recursion works is by evaluating the bottom of the recursive ‘tree’ structure and moving all the way to the ‘top’, where the last call returns the answer.  The same thing happens when we sort an array using merge sort:</p>
<p><img alt="" src="../../_images/mergesort_1.png" />
<img alt="" src="../../_images/mergesort_2.png" />
<img alt="" src="../../_images/mergesort_3.png" />
<img alt="" src="../../_images/mergesort_4.png" />
<img alt="" src="../../_images/mergesort_5.png" /></p>
<p>Here we explicitly divide into subarrays, merge and then recurse up to the next call.  This strategy of divide, conquer and recurse up ends up making a <em>very</em> fast algorithm.</p>
<p>Let’s plot the running times over the algorithms we’ve seen so far as the input size varies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">simple_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arr</span>

<span class="k">def</span> <span class="nf">insertion_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pivot</span><span class="p">):</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot</span>
    <span class="k">return</span> <span class="n">arr</span>

<span class="k">def</span> <span class="nf">selection_sort</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">smallest</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">smallest_index</span> <span class="o">=</span> <span class="n">j</span>
        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">smallest</span><span class="p">:</span>
                <span class="n">smallest</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">smallest_index</span> <span class="o">=</span> <span class="n">j</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">smallest</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">smallest_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">arr</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sorting_algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">selection_sort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">insertion_sort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">simple_sort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">merge_sort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">selection_sort_rt</span><span class="p">,</span>
        <span class="n">insertion_sort_rt</span><span class="p">,</span>
        <span class="n">simple_sort_rt</span><span class="p">,</span>
        <span class="n">merge_sort_rt</span>
    <span class="p">]</span>
    <span class="n">sorting_algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">selection_sort</span><span class="p">,</span> 
        <span class="n">insertion_sort</span><span class="p">,</span> 
        <span class="n">simple_sort</span><span class="p">,</span> 
        <span class="n">merge_sort</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sorting_algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorting_algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_5_0.png" src="../../_images/recursive_sorting_and_data_structures_5_0.png" />
</div>
</div>
<p>In the above graph:</p>
<ul class="simple">
<li><p>blue = selection sort</p></li>
<li><p>green = insertion sort</p></li>
<li><p>red = simple sort</p></li>
<li><p>orange = merge sort</p></li>
</ul>
<p>As you can see merge sort performs the best, and by a lot.  That’s because the running time for merge sort is <em>orders of magnitude faster</em>, asymptotically.</p>
<p>Next, let’s look at another sorting algorithm that typically gets used in industry, quick sort.  Quick sort is also a divide and conquer algorithm therefore it has a similar implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">less</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_quicksort</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="n">sorted_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="n">sorted_array</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">sorted_array</span>
        
<span class="n">test_quicksort</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here the swap’s and comparisons appear in one block so we’ll just show the block and point to each.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
        <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
        <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</pre></div>
</div>
<p>The flow of control of the if/elif/else are the comparisons, pretty obviously.  And the appends to the three different arrays the ‘swaps’. That’s because the pivot partitions the larger array into three seperate groups.  And then they all get ‘glued’ together in the return statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see there is no explicit divide and conquer ‘framework’. And we don’t segregate the computational component and the sorting component.  It all just happens contiguously.  By doing ‘less work’ - fewer function calls, fewer iterations, and just less overall, quicksort is kind of like a very ‘sparse’ version of merge sort.</p>
<p>Next, let’s do a performance comparison between quick sort and merge sort:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sorting_algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">merge_sort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">merge_sort_rt</span><span class="p">,</span>
        <span class="n">quicksort_rt</span>
    <span class="p">]</span>
    <span class="n">sorting_algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">merge_sort</span><span class="p">,</span>
        <span class="n">quicksort</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sorting_algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorting_algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_9_0.png" src="../../_images/recursive_sorting_and_data_structures_9_0.png" />
</div>
</div>
<p>In the above graph:</p>
<ul class="simple">
<li><p>blue - merge sort</p></li>
<li><p>green - quick sort</p></li>
</ul>
<p>As you can see, quick sort is typically somewhat faster than merge sort.  Thus it is the most often used algorithm in industry.  That said, there are certain instances when merge sort will be faster.  These are subject to computation constraints, array specifics and other factors beyond the scope of this text.</p>
<p>Before we leave this section, let’s talk a bit more about quick sort.  There is one line in the implementation that’s important, that we did not talk about at all - the pivot.  We arbitrarily chose the front of the array.  But is that the best choice?</p>
<p>Consider an array that is in reverse sorted order, if we always choose the first element as pivot then won’t everything end up in less?  YUP.  So our ‘partition’ will always be <em>very lopsided</em>.  This means that quicksort will always perform kinda slow.  Let’s see if it makes quick sort worse than merge sort:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sorting_algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">merge_sort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">merge_sort_rt</span><span class="p">,</span>
        <span class="n">quicksort_rt</span>
    <span class="p">]</span>
    <span class="n">sorting_algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">merge_sort</span><span class="p">,</span>
        <span class="n">quicksort</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sorting_algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorting_algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_11_0.png" src="../../_images/recursive_sorting_and_data_structures_11_0.png" />
</div>
</div>
<p>In the above graph:</p>
<ul class="simple">
<li><p>blue - merge sort</p></li>
<li><p>green - quick sort</p></li>
</ul>
<p>As you can see, quick sort does <em>way worse</em>.  This is because of the problem we talked about.  So our choice of partition matters <em>a lot</em>.  What can we do about this?  How can we change the pivot to always give us a good split?  One naive approach for improvement would be to choose a random pivot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">random_quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">less</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">random_quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">random_quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_random_quicksort</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="n">sorted_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="n">sorted_array</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">random_quicksort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">sorted_array</span>
        
<span class="n">test_random_quicksort</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This at least will do better than choosing the first element when the array is reverse sorted.  In fact, the chance of that happening is something we can calculate!  We can use binomial random variable to help us figure this out since the choice of the pivot will now be independent and there will be N trials!</p>
<p>Our formula for the binomial random variable is:</p>
<div class="math notranslate nohighlight">
\[ {n \choose k} p^{k} * q^{n - k} \]</div>
<p>Now there will be <span class="math notranslate nohighlight">\(log\text{ }n\)</span> calls on average to <code class="docutils literal notranslate"><span class="pre">quicksort</span></code> and there will be a <span class="math notranslate nohighlight">\(\frac{1}{r}\)</span> probability that the first element is chosen as the pivot.  Here <span class="math notranslate nohighlight">\(r\)</span> is the size of the subarray being considered for the recursive call.</p>
<p>Thus the updated formula will be:</p>
<div class="math notranslate nohighlight">
\[ {log\text{ }n \choose 1} \frac{1}{r} * \frac{(r-1)^{n - 1}}{r^{n - 1}} \]</div>
<p>For the probability of choosing <em>any</em> given position for any call to <code class="docutils literal notranslate"><span class="pre">quicksort</span></code> during sorting.</p>
<p>Since the size of the array is variable in general, we can’t <em>really</em> say better than that.  It would be pretty tough to predict the split of <em>each</em> sub array.  So unfortunately this is the best we can do from an analysis perspective.</p>
<p>There is one final point worth bringing up - how did we know that there would be <span class="math notranslate nohighlight">\(log\text{ }n\)</span> splits on average?  Let’s remind ourselves of what the logarithm function stands for - repeated division:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">logarithm</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">/=</span> <span class="n">base</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">counter</span>
</pre></div>
</div>
</div>
</div>
<p>As you can see, the log just repeatedly divides the base into the number.  So for instance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logarithm</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7
</pre></div>
</div>
</div>
</div>
<p>This is because <span class="math notranslate nohighlight">\(2^{7} \approx 100\)</span>.  Remember - the above implementation is the <em>integer logarithm algorithm</em>.  So when we are dealing with real numbers it doesn’t <em>exactly</em> work.  For instance, if we look at <span class="math notranslate nohighlight">\(2^{7}\)</span> in the reals:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>128
</pre></div>
</div>
</div>
</div>
<p>So we are definitely <em>off</em>.  But the above gets us the idea we are after - the logarithm is <em>repeated</em> division.  That’s why we can use it to approximate the number of calls that quicksort will make to itself recursively - at each stage we divide the array into two subarrays, so <span class="math notranslate nohighlight">\(log_{2}\)</span> <em>accurately</em> depicts what’s going on.  In particular, it tells us how many function calls we can expect <em>always</em> because we are always just dividing base 2.  Yea, the number of recursive calls is variable, but that’s okay, that’s why we are dealing with a function!</p>
<div class="math notranslate nohighlight">
\[ f(x) = log_{2} x \]</div>
<p>So we can just plug in x for the initial size of our array and we will always get back something <em>approximately</em> correct!  This does assume our choice in pivot is reasonable.  For this we just need to look at the central tendency of a set of random numbers.  Our candidates for that are the arthimetic mean which is defined by this formula -</p>
<div class="math notranslate nohighlight">
\[ \frac{1}{N}\sum_{i=0}^{n} i\]</div>
<p>And the median which is just the middle number of a sorted array.  Let’s calculate how different the mean and the median are for a set of random numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_bias</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">num_trials</span><span class="p">):</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">-</span> <span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">))</span><span class="o">/</span><span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">sizes</span>

<span class="n">max_size</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">num_trials</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">trials</span> <span class="o">=</span> <span class="n">calculate_bias</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">num_trials</span><span class="p">)</span>

<span class="k">for</span> <span class="n">trial_set</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="n">trial_set</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;array_size=</span><span class="si">{</span><span class="n">trial_set</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_21_0.png" src="../../_images/recursive_sorting_and_data_structures_21_0.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_1.png" src="../../_images/recursive_sorting_and_data_structures_21_1.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_2.png" src="../../_images/recursive_sorting_and_data_structures_21_2.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_3.png" src="../../_images/recursive_sorting_and_data_structures_21_3.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_4.png" src="../../_images/recursive_sorting_and_data_structures_21_4.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_5.png" src="../../_images/recursive_sorting_and_data_structures_21_5.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_6.png" src="../../_images/recursive_sorting_and_data_structures_21_6.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_7.png" src="../../_images/recursive_sorting_and_data_structures_21_7.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_8.png" src="../../_images/recursive_sorting_and_data_structures_21_8.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_9.png" src="../../_images/recursive_sorting_and_data_structures_21_9.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_10.png" src="../../_images/recursive_sorting_and_data_structures_21_10.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_11.png" src="../../_images/recursive_sorting_and_data_structures_21_11.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_12.png" src="../../_images/recursive_sorting_and_data_structures_21_12.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_13.png" src="../../_images/recursive_sorting_and_data_structures_21_13.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_14.png" src="../../_images/recursive_sorting_and_data_structures_21_14.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_15.png" src="../../_images/recursive_sorting_and_data_structures_21_15.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_16.png" src="../../_images/recursive_sorting_and_data_structures_21_16.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_17.png" src="../../_images/recursive_sorting_and_data_structures_21_17.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_18.png" src="../../_images/recursive_sorting_and_data_structures_21_18.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_19.png" src="../../_images/recursive_sorting_and_data_structures_21_19.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_20.png" src="../../_images/recursive_sorting_and_data_structures_21_20.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_21.png" src="../../_images/recursive_sorting_and_data_structures_21_21.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_22.png" src="../../_images/recursive_sorting_and_data_structures_21_22.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_23.png" src="../../_images/recursive_sorting_and_data_structures_21_23.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_24.png" src="../../_images/recursive_sorting_and_data_structures_21_24.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_25.png" src="../../_images/recursive_sorting_and_data_structures_21_25.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_26.png" src="../../_images/recursive_sorting_and_data_structures_21_26.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_27.png" src="../../_images/recursive_sorting_and_data_structures_21_27.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_28.png" src="../../_images/recursive_sorting_and_data_structures_21_28.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_29.png" src="../../_images/recursive_sorting_and_data_structures_21_29.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_30.png" src="../../_images/recursive_sorting_and_data_structures_21_30.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_31.png" src="../../_images/recursive_sorting_and_data_structures_21_31.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_32.png" src="../../_images/recursive_sorting_and_data_structures_21_32.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_33.png" src="../../_images/recursive_sorting_and_data_structures_21_33.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_34.png" src="../../_images/recursive_sorting_and_data_structures_21_34.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_35.png" src="../../_images/recursive_sorting_and_data_structures_21_35.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_36.png" src="../../_images/recursive_sorting_and_data_structures_21_36.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_37.png" src="../../_images/recursive_sorting_and_data_structures_21_37.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_38.png" src="../../_images/recursive_sorting_and_data_structures_21_38.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_39.png" src="../../_images/recursive_sorting_and_data_structures_21_39.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_40.png" src="../../_images/recursive_sorting_and_data_structures_21_40.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_41.png" src="../../_images/recursive_sorting_and_data_structures_21_41.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_42.png" src="../../_images/recursive_sorting_and_data_structures_21_42.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_43.png" src="../../_images/recursive_sorting_and_data_structures_21_43.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_44.png" src="../../_images/recursive_sorting_and_data_structures_21_44.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_45.png" src="../../_images/recursive_sorting_and_data_structures_21_45.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_46.png" src="../../_images/recursive_sorting_and_data_structures_21_46.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_47.png" src="../../_images/recursive_sorting_and_data_structures_21_47.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_21_48.png" src="../../_images/recursive_sorting_and_data_structures_21_48.png" />
</div>
</div>
<p>In the above calculation you may be wondering about -</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">abs</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">-</span> <span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">))</span><span class="o">/</span><span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
<p>Should we just take the absolute value of the difference?  Why do we need to account for the maximum element in the array?  The <em>reason</em> we normalize by the median element in the random array is because the difference will be subject to the magnitude of the array.  We <em>could</em> normalize by the max element but we want to allow for some of the bias in the mean to come through.  In general, it appears that the mean isn’t that different an estimate when compared to the mean.  However, if we take away the normalizing factor, than we see that the two statistics give us a very different set of answers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_bias</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">num_trials</span><span class="p">):</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">-</span> <span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">sizes</span>

<span class="n">max_size</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">num_trials</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">trials</span> <span class="o">=</span> <span class="n">calculate_bias</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">num_trials</span><span class="p">)</span>

<span class="k">for</span> <span class="n">trial_set</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="n">trial_set</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;array_size=</span><span class="si">{</span><span class="n">trial_set</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_23_0.png" src="../../_images/recursive_sorting_and_data_structures_23_0.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_1.png" src="../../_images/recursive_sorting_and_data_structures_23_1.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_2.png" src="../../_images/recursive_sorting_and_data_structures_23_2.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_3.png" src="../../_images/recursive_sorting_and_data_structures_23_3.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_4.png" src="../../_images/recursive_sorting_and_data_structures_23_4.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_5.png" src="../../_images/recursive_sorting_and_data_structures_23_5.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_6.png" src="../../_images/recursive_sorting_and_data_structures_23_6.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_7.png" src="../../_images/recursive_sorting_and_data_structures_23_7.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_8.png" src="../../_images/recursive_sorting_and_data_structures_23_8.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_9.png" src="../../_images/recursive_sorting_and_data_structures_23_9.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_10.png" src="../../_images/recursive_sorting_and_data_structures_23_10.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_11.png" src="../../_images/recursive_sorting_and_data_structures_23_11.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_12.png" src="../../_images/recursive_sorting_and_data_structures_23_12.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_13.png" src="../../_images/recursive_sorting_and_data_structures_23_13.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_14.png" src="../../_images/recursive_sorting_and_data_structures_23_14.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_15.png" src="../../_images/recursive_sorting_and_data_structures_23_15.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_16.png" src="../../_images/recursive_sorting_and_data_structures_23_16.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_17.png" src="../../_images/recursive_sorting_and_data_structures_23_17.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_18.png" src="../../_images/recursive_sorting_and_data_structures_23_18.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_19.png" src="../../_images/recursive_sorting_and_data_structures_23_19.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_20.png" src="../../_images/recursive_sorting_and_data_structures_23_20.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_21.png" src="../../_images/recursive_sorting_and_data_structures_23_21.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_22.png" src="../../_images/recursive_sorting_and_data_structures_23_22.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_23.png" src="../../_images/recursive_sorting_and_data_structures_23_23.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_24.png" src="../../_images/recursive_sorting_and_data_structures_23_24.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_25.png" src="../../_images/recursive_sorting_and_data_structures_23_25.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_26.png" src="../../_images/recursive_sorting_and_data_structures_23_26.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_27.png" src="../../_images/recursive_sorting_and_data_structures_23_27.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_28.png" src="../../_images/recursive_sorting_and_data_structures_23_28.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_29.png" src="../../_images/recursive_sorting_and_data_structures_23_29.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_30.png" src="../../_images/recursive_sorting_and_data_structures_23_30.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_31.png" src="../../_images/recursive_sorting_and_data_structures_23_31.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_32.png" src="../../_images/recursive_sorting_and_data_structures_23_32.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_33.png" src="../../_images/recursive_sorting_and_data_structures_23_33.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_34.png" src="../../_images/recursive_sorting_and_data_structures_23_34.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_35.png" src="../../_images/recursive_sorting_and_data_structures_23_35.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_36.png" src="../../_images/recursive_sorting_and_data_structures_23_36.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_37.png" src="../../_images/recursive_sorting_and_data_structures_23_37.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_38.png" src="../../_images/recursive_sorting_and_data_structures_23_38.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_39.png" src="../../_images/recursive_sorting_and_data_structures_23_39.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_40.png" src="../../_images/recursive_sorting_and_data_structures_23_40.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_41.png" src="../../_images/recursive_sorting_and_data_structures_23_41.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_42.png" src="../../_images/recursive_sorting_and_data_structures_23_42.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_43.png" src="../../_images/recursive_sorting_and_data_structures_23_43.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_44.png" src="../../_images/recursive_sorting_and_data_structures_23_44.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_45.png" src="../../_images/recursive_sorting_and_data_structures_23_45.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_46.png" src="../../_images/recursive_sorting_and_data_structures_23_46.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_47.png" src="../../_images/recursive_sorting_and_data_structures_23_47.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_23_48.png" src="../../_images/recursive_sorting_and_data_structures_23_48.png" />
</div>
</div>
<p>This is <em>somewhat</em> overstated because of the relatively large magnitude of the range of random numbers.  Suppose instead we restricted ourselves to arrays with a max value of 1000:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_bias</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">num_trials</span><span class="p">):</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">-</span> <span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">sizes</span>

<span class="n">max_size</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">num_trials</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">trials</span> <span class="o">=</span> <span class="n">calculate_bias</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">num_trials</span><span class="p">)</span>

<span class="k">for</span> <span class="n">trial_set</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="n">trial_set</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;array_size=</span><span class="si">{</span><span class="n">trial_set</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_25_0.png" src="../../_images/recursive_sorting_and_data_structures_25_0.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_1.png" src="../../_images/recursive_sorting_and_data_structures_25_1.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_2.png" src="../../_images/recursive_sorting_and_data_structures_25_2.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_3.png" src="../../_images/recursive_sorting_and_data_structures_25_3.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_4.png" src="../../_images/recursive_sorting_and_data_structures_25_4.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_5.png" src="../../_images/recursive_sorting_and_data_structures_25_5.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_6.png" src="../../_images/recursive_sorting_and_data_structures_25_6.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_7.png" src="../../_images/recursive_sorting_and_data_structures_25_7.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_8.png" src="../../_images/recursive_sorting_and_data_structures_25_8.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_9.png" src="../../_images/recursive_sorting_and_data_structures_25_9.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_10.png" src="../../_images/recursive_sorting_and_data_structures_25_10.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_11.png" src="../../_images/recursive_sorting_and_data_structures_25_11.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_12.png" src="../../_images/recursive_sorting_and_data_structures_25_12.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_13.png" src="../../_images/recursive_sorting_and_data_structures_25_13.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_14.png" src="../../_images/recursive_sorting_and_data_structures_25_14.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_15.png" src="../../_images/recursive_sorting_and_data_structures_25_15.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_16.png" src="../../_images/recursive_sorting_and_data_structures_25_16.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_17.png" src="../../_images/recursive_sorting_and_data_structures_25_17.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_18.png" src="../../_images/recursive_sorting_and_data_structures_25_18.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_19.png" src="../../_images/recursive_sorting_and_data_structures_25_19.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_20.png" src="../../_images/recursive_sorting_and_data_structures_25_20.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_21.png" src="../../_images/recursive_sorting_and_data_structures_25_21.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_22.png" src="../../_images/recursive_sorting_and_data_structures_25_22.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_23.png" src="../../_images/recursive_sorting_and_data_structures_25_23.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_24.png" src="../../_images/recursive_sorting_and_data_structures_25_24.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_25.png" src="../../_images/recursive_sorting_and_data_structures_25_25.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_26.png" src="../../_images/recursive_sorting_and_data_structures_25_26.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_27.png" src="../../_images/recursive_sorting_and_data_structures_25_27.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_28.png" src="../../_images/recursive_sorting_and_data_structures_25_28.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_29.png" src="../../_images/recursive_sorting_and_data_structures_25_29.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_30.png" src="../../_images/recursive_sorting_and_data_structures_25_30.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_31.png" src="../../_images/recursive_sorting_and_data_structures_25_31.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_32.png" src="../../_images/recursive_sorting_and_data_structures_25_32.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_33.png" src="../../_images/recursive_sorting_and_data_structures_25_33.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_34.png" src="../../_images/recursive_sorting_and_data_structures_25_34.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_35.png" src="../../_images/recursive_sorting_and_data_structures_25_35.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_36.png" src="../../_images/recursive_sorting_and_data_structures_25_36.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_37.png" src="../../_images/recursive_sorting_and_data_structures_25_37.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_38.png" src="../../_images/recursive_sorting_and_data_structures_25_38.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_39.png" src="../../_images/recursive_sorting_and_data_structures_25_39.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_40.png" src="../../_images/recursive_sorting_and_data_structures_25_40.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_41.png" src="../../_images/recursive_sorting_and_data_structures_25_41.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_42.png" src="../../_images/recursive_sorting_and_data_structures_25_42.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_43.png" src="../../_images/recursive_sorting_and_data_structures_25_43.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_44.png" src="../../_images/recursive_sorting_and_data_structures_25_44.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_45.png" src="../../_images/recursive_sorting_and_data_structures_25_45.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_46.png" src="../../_images/recursive_sorting_and_data_structures_25_46.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_47.png" src="../../_images/recursive_sorting_and_data_structures_25_47.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_25_48.png" src="../../_images/recursive_sorting_and_data_structures_25_48.png" />
</div>
</div>
<p>As you can see, we are off by <em>some</em> consistently and the exact amount is pretty random.  But it’s not <em>terrible</em> for small values.  Thus the mean is a reasonable <em>estimate</em>.  So let’s use that as a first approximation for our random pivot:</p>
<p>We should expect a speed up of for an array that is reverse sorted:</p>
<div class="math notranslate nohighlight">
\[ log_{2} \text{ }\frac{n}{2} \]</div>
<p>Let’s see how it compares in general to quick sort:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sorting_algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">random_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">random_quicksort_rt</span><span class="p">,</span>
        <span class="n">quicksort_rt</span>
    <span class="p">]</span>
    <span class="n">sorting_algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">random_quicksort</span><span class="p">,</span>
        <span class="n">quicksort</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sorting_algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorting_algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">30000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_27_0.png" src="../../_images/recursive_sorting_and_data_structures_27_0.png" />
</div>
</div>
<p>For this graph:</p>
<ul class="simple">
<li><p>blue is random quick sort</p></li>
<li><p>green is original quick sort</p></li>
</ul>
<p>Looks like it runs a little slower than the original quick sort, when we are dealing with random elements.  Now let’s look at reverse sorted arrays:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sorting_algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">random_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">random_quicksort_rt</span><span class="p">,</span>
        <span class="n">quicksort_rt</span>
    <span class="p">]</span>
    <span class="n">sorting_algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">random_quicksort</span><span class="p">,</span>
        <span class="n">quicksort</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sorting_algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorting_algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sorting_algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_29_0.png" src="../../_images/recursive_sorting_and_data_structures_29_0.png" />
</div>
</div>
<p>For this graph:</p>
<ul class="simple">
<li><p>blue is random quick sort</p></li>
<li><p>green is original quick sort</p></li>
</ul>
<p>As you can see, the original does <em>much much</em> worse when the array is in reverse sorted order.  Since it only does slightly worse when things are pretty random, overall the random pivot is definitely an improvement.  But can we do better?  Well, we saw that the mean is a biased estimator, and our choice of random number is probably better approximated in its typical behavior by the mean than the median since the mean captures more of the skew of the distribution.  So how can we limit this skew factor to create more even splits?  We <em>could</em> select the middle number.  But doesn’t that require a sorted array?</p>
<p>Let’s start investigating how we can intelligently select elements from an array.  By understanding selection and how to make it efficient, we can pick a better pivot.</p>
<p>Let’s begin with a naive selection algorithm:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statistics</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">test_find_middle</span><span class="p">():</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="mi">501</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">250</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="mi">502</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">251</span>
    
        
<span class="n">test_find_middle</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Not bad!  We find the middle number of a sorted array in <em>constant time</em>.  Does this hold up with repeated numbers?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">test_find_middle</span><span class="p">():</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="mi">501</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">251</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="mi">502</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">252</span>
    
        
<span class="n">test_find_middle</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">37</span><span class="o">-</span><span class="mf">209e631</span><span class="n">eaec1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> 
<span class="g g-Whitespace">     </span><span class="mi">13</span> 
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="n">test_find_middle</span><span class="p">()</span>

<span class="nn">&lt;ipython-input-37-209e631eaec1&gt;</span> in <span class="ni">test_find_middle</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="k">assert</span> <span class="n">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">251</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="mi">502</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">11</span>     <span class="k">assert</span> <span class="n">find_middle</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">252</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> 
<span class="g g-Whitespace">     </span><span class="mi">13</span> 

<span class="ne">AssertionError</span>: 
</pre></div>
</div>
</div>
</div>
<p>Nope!  This algorithm only works on that simple case.  Let’s move onto something more sophisticated that actually searches for the middle number:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="n">mid_point</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">array</span><span class="p">[</span><span class="n">mid_point</span><span class="p">]</span> <span class="o">==</span> <span class="n">element</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">element</span>
    <span class="k">elif</span> <span class="n">array</span><span class="p">[</span><span class="n">mid_point</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">element</span><span class="p">:</span>
        <span class="n">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">[:</span><span class="n">mid_point</span><span class="p">],</span> <span class="n">element</span><span class="p">)</span>
        <span class="n">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">mid_point</span><span class="p">:],</span> <span class="n">element</span><span class="p">)</span>

<span class="n">binary_search</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<p>Another way we could search for an element in an array is with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>However the built-in <code class="docutils literal notranslate"><span class="pre">in</span></code> operator that comes with python runs in linear time.  Let’s compare the <code class="docutils literal notranslate"><span class="pre">in</span></code> with our <code class="docutils literal notranslate"><span class="pre">binary_search</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">binary_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
<span class="k">def</span> <span class="nf">linear_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">random_element</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span>
    <span class="n">algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span> <span class="n">random_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">binary_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">linear_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find_rt</span><span class="p">,</span>
        <span class="n">linear_find_rt</span>
    <span class="p">]</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find</span><span class="p">,</span>
        <span class="n">linear_find</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_39_0.png" src="../../_images/recursive_sorting_and_data_structures_39_0.png" />
</div>
</div>
<p>Here is the graph:</p>
<ul class="simple">
<li><p>blue is binary search</p></li>
<li><p>green is linear search</p></li>
</ul>
<p>Let’s see what happens if we take the sorting out of the binary search:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">binary_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
<span class="k">def</span> <span class="nf">linear_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">random_element</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span>
    <span class="n">algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span> <span class="n">random_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">binary_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">linear_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find_rt</span><span class="p">,</span>
        <span class="n">linear_find_rt</span>
    <span class="p">]</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find</span><span class="p">,</span>
        <span class="n">linear_find</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_41_0.png" src="../../_images/recursive_sorting_and_data_structures_41_0.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_1.png" src="../../_images/recursive_sorting_and_data_structures_41_1.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_2.png" src="../../_images/recursive_sorting_and_data_structures_41_2.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_3.png" src="../../_images/recursive_sorting_and_data_structures_41_3.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_4.png" src="../../_images/recursive_sorting_and_data_structures_41_4.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_5.png" src="../../_images/recursive_sorting_and_data_structures_41_5.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_6.png" src="../../_images/recursive_sorting_and_data_structures_41_6.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_7.png" src="../../_images/recursive_sorting_and_data_structures_41_7.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_8.png" src="../../_images/recursive_sorting_and_data_structures_41_8.png" />
<img alt="../../_images/recursive_sorting_and_data_structures_41_9.png" src="../../_images/recursive_sorting_and_data_structures_41_9.png" />
</div>
</div>
<p>Here as before:</p>
<ul class="simple">
<li><p>blue is binary search</p></li>
<li><p>green is linear search</p></li>
</ul>
<p>Once we take out the sorting algorithm binary search does better as we scale up the size of the array.  Let’s see if what happens as we increase the size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">binary_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
<span class="k">def</span> <span class="nf">linear_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">random_element</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span>
    <span class="n">algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span> <span class="n">random_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">random_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">random_quicksort_rt</span><span class="p">,</span>
        <span class="n">quicksort_rt</span>
    <span class="p">]</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find</span><span class="p">,</span>
        <span class="n">linear_find</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_43_0.png" src="../../_images/recursive_sorting_and_data_structures_43_0.png" />
</div>
</div>
<p>If you keep increasing the graph.  It looks like the gains we saw from binary search more or less dispate.  If we continue to extend this trend to arrays of size 10000 we see:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">binary_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
<span class="k">def</span> <span class="nf">linear_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">random_element</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span>
    <span class="n">algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span> <span class="n">random_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">binary_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">linear_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find_rt</span><span class="p">,</span>
        <span class="n">linear_find_rt</span>
    <span class="p">]</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find</span><span class="p">,</span>
        <span class="n">linear_find</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">array</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_45_0.png" src="../../_images/recursive_sorting_and_data_structures_45_0.png" />
</div>
</div>
<p>In the above graph:</p>
<ul class="simple">
<li><p>blue is binary search</p></li>
<li><p>green is linear search</p></li>
</ul>
<p>As you can see, once we get to a large enough scale, the binary search absolutely and definitively out performs the linear search.  Let’s see what happens if we add sorting back into the algorithm - will binary search still win out?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">binary_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="n">array</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">binary_search</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
<span class="k">def</span> <span class="nf">linear_find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">):</span>
    <span class="n">tmp_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">random_element</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span>
    <span class="n">algorithm</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span> <span class="n">random_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">binary_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">linear_find_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find_rt</span><span class="p">,</span>
        <span class="n">linear_find_rt</span>
    <span class="p">]</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">binary_find</span><span class="p">,</span>
        <span class="n">linear_find</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_47_0.png" src="../../_images/recursive_sorting_and_data_structures_47_0.png" />
</div>
</div>
<p>The colors haven’t changed from the last graph so:</p>
<ul class="simple">
<li><p>blue is binary search</p></li>
<li><p>green is linear search</p></li>
</ul>
<p>As you can see, the gains are definitely <em>less</em> pronounced.  But clearly binary search still performs better at least half the time.  Linear search is significantly more choatic as the number of elements increases.  But now there is a clear linear increase in running time because of the added sorting prior to searching.  Overall, not a bad candidate from a performance perspective.  But needing to sort the elements ahead of time just doesn’t seem like a good idea for use within quicksort.</p>
<p>Our next candidate will be the median.  If we could calculate the median then, we could always choose the ‘middle number’ which would mean we always do a best choice split.</p>
<p>Let’s begin by reviewing how we can get the minimum and maximum of a list:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">minimum</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">_min</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">element</span> <span class="o">&lt;</span> <span class="n">_min</span><span class="p">:</span>
            <span class="n">_min</span> <span class="o">=</span> <span class="n">element</span>
    <span class="k">return</span> <span class="n">_min</span>

<span class="k">def</span> <span class="nf">maximum</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">_max</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">element</span> <span class="o">&gt;</span> <span class="n">_max</span><span class="p">:</span>
            <span class="n">_max</span> <span class="o">=</span> <span class="n">element</span>
    <span class="k">return</span> <span class="n">_max</span>

<span class="k">def</span> <span class="nf">test_minimum</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="n">minimum</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_maximum</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="n">maximum</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="n">test_minimum</span><span class="p">()</span>
<span class="n">test_maximum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This allows us to <em>linearly</em> search an unsorted array for the least or greatest element, <em>regardless</em> of position.  This means we know prior information and we don’t need to sort our array ahead of time.  This sort of algorithm is called <em>on-line</em> because we need to know prior informatio and can process ‘on the line’.  The term ‘on the line’ is a reference to a factory assembly line.  And the array is sort of like the assembly line itself.  By processing on the line, really what we are saying is we look only once at the array during the single run and make our updates from there.</p>
<p>Now let’s consider the generic case of trying to find the ith smallest element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">partition</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="n">end_value</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">end</span><span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_value</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">arr</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">end</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>

<span class="k">def</span> <span class="nf">randomized_partition</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">end</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="n">end</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">partition</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_randomized_select</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="n">partition_index</span> <span class="o">=</span> <span class="n">randomized_partition</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">partition_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">partition_index</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="n">partition_index</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_randomized_select</span><span class="p">(</span>
            <span class="n">arr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">partition_index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_randomized_select</span><span class="p">(</span>
            <span class="n">arr</span><span class="p">,</span> <span class="n">partition_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">index</span> <span class="o">-</span> <span class="n">pivot</span>
        <span class="p">)</span>

<span class="k">def</span> <span class="nf">randomized_select</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">quantile</span><span class="p">):</span>
    <span class="n">quantile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">quantile</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_randomized_select</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">quantile</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_randomized_select</span><span class="p">():</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">501</span><span class="p">)]</span>
    <span class="n">sorted_arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:]</span>
    <span class="n">sorted_arr</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">randomized_select</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">==</span> <span class="n">sorted_arr</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
    
<span class="n">test_randomized_select</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll have to delay the formal analysis of this algorithm until we introduce the necessary techniques to analyze a recursive algorithm’s running time.  For now let’s settle for an informal analysis via running time.</p>
<p>We can apply our <code class="docutils literal notranslate"><span class="pre">randomized_select</span></code> algorithm to quicksort.  Let’s see if we do better than selecting a random element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">median_quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">randomized_select</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">less</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">median_quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">median_quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">test_median_quicksort</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="n">sorted_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="n">sorted_array</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">median_quicksort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">sorted_array</span>
        
<span class="n">test_median_quicksort</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In order to clean up the code on measuring the running time of different algorithms we will introduce a concept called a decorator.  Let’s look at the implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">calculate_time</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="k">return</span> <span class="n">inner</span>

<span class="k">def</span> <span class="nf">sample_function</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

<span class="n">timed</span> <span class="o">=</span> <span class="n">calculate_time</span><span class="p">(</span><span class="n">sample_function</span><span class="p">)</span>
<span class="n">timed</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.86102294921875e-06
</pre></div>
</div>
</div>
</div>
<p>Now we can apply calculate time directly to our sorts which will clean up the code for measuring running times significantly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">median_quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">randomized_select</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">less</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">median_quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">median_quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">random_quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">less</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">random_quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">random_quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">less</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>

<span class="n">timed_quicksort</span> <span class="o">=</span> <span class="n">calculate_time</span><span class="p">(</span><span class="n">quicksort</span><span class="p">)</span>
<span class="n">timed_random_quicksort</span> <span class="o">=</span> <span class="n">calculate_time</span><span class="p">(</span><span class="n">random_quicksort</span><span class="p">)</span>
<span class="n">timed_median_quicksort</span> <span class="o">=</span> <span class="n">calculate_time</span><span class="p">(</span><span class="n">median_quicksort</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">median_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">random_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">median_quicksort_rt</span><span class="p">,</span>
        <span class="n">random_quicksort_rt</span><span class="p">,</span>
        <span class="n">quicksort_rt</span>
    <span class="p">]</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">timed_median_quicksort</span><span class="p">,</span>
        <span class="n">timed_random_quicksort</span><span class="p">,</span>
        <span class="n">timed_quicksort</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">algorithm</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_58_0.png" src="../../_images/recursive_sorting_and_data_structures_58_0.png" />
</div>
</div>
<p>In the above graph:</p>
<ul class="simple">
<li><p>blue is our median_quicksort</p></li>
<li><p>green is random_quicksort</p></li>
<li><p>orange is quicksort</p></li>
</ul>
<p>Clearly random quicksort is the best, especially as the number of elements in the array grows.  Our median quicksort does the worst.  And the original quicksort is bounded between the two other versions of quicksort.  So it looks like picking the middle number is consistently <em>suboptimal</em>.  While selecting a random element is <em>always</em> better than picking the first element.  In a sense this isn’t surprising.  Our algorithm for implementing selecting the median is fairly complex.  If we could do better, making this selection algorithm <em>less complex</em> perhaps we could do better than a random pivot.  We’ll attempt this with an algorithm called select:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">partition_five</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">left_index</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">right_index</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="n">left_index</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
            <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">left_index</span> <span class="o">+</span> <span class="n">right_index</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">right_index</span> <span class="o">-</span> <span class="n">left_index</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partition_five</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="n">sub_right</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">sub_right</span> <span class="o">&gt;</span> <span class="n">right_index</span><span class="p">:</span>
            <span class="n">sub_right</span> <span class="o">=</span> <span class="n">right_index</span>
        <span class="n">median_five</span> <span class="o">=</span> <span class="n">partition_five</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sub_right</span><span class="p">)</span>
        <span class="n">array</span><span class="p">[</span><span class="n">median_five</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">left_index</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">left_index</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">)]</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">right_index</span> <span class="o">-</span> <span class="n">left_index</span><span class="p">)</span><span class="o">//</span><span class="mi">10</span> <span class="o">+</span> <span class="n">left_index</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">select</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">left_index</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">right_index</span> <span class="o">-</span> <span class="n">left_index</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">),</span> <span class="n">mid</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_partition</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">,</span> <span class="n">pivot_index</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">pivot_value</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">pivot_index</span><span class="p">]</span>
    <span class="n">array</span><span class="p">[</span><span class="n">pivot_index</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">right_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">right_index</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">pivot_index</span><span class="p">]</span>
    <span class="n">store_index</span> <span class="o">=</span> <span class="n">left_index</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pivot_value</span><span class="p">:</span>
            <span class="n">array</span><span class="p">[</span><span class="n">store_index</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">store_index</span><span class="p">]</span>
            <span class="n">store_index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">store_index_eq</span> <span class="o">=</span> <span class="n">store_index</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">store_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">pivot_value</span><span class="p">:</span>
            <span class="n">array</span><span class="p">[</span><span class="n">store_index_eq</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">store_index_eq</span><span class="p">]</span>
            <span class="n">store_index_eq</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">array</span><span class="p">[</span><span class="n">right_index</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">store_index_eq</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">store_index_eq</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">right_index</span><span class="p">]</span> 
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">store_index</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">store_index</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="n">store_index_eq</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">index</span>
    <span class="k">return</span> <span class="n">store_index_eq</span>

<span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">left_index</span> <span class="o">==</span> <span class="n">right_index</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">left_index</span>
    <span class="n">pivot_index</span> <span class="o">=</span> <span class="n">pivot</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">)</span>
    <span class="n">pivot_index</span> <span class="o">=</span> <span class="n">_partition</span><span class="p">(</span>
        <span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">,</span> <span class="n">pivot_index</span><span class="p">,</span> <span class="n">index</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">pivot_index</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">index</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">pivot_index</span><span class="p">:</span>
        <span class="n">right_index</span> <span class="o">=</span> <span class="n">pivot_index</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">left_index</span> <span class="o">=</span> <span class="n">pivot_index</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">select</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

<span class="n">select</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<p>let’s see if this yields a faster quicksort:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">select_quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pivot_index</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">pivot_index</span><span class="p">]</span>
        <span class="n">less</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">equal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">less</span><span class="p">)</span><span class="o">+</span><span class="n">equal</span><span class="o">+</span><span class="n">quicksort</span><span class="p">(</span><span class="n">greater</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">test_select_quicksort</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="n">sorted_arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:]</span>
        <span class="n">sorted_arr</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">select_quicksort</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="n">sorted_arr</span>
        
<span class="n">test_select_quicksort</span><span class="p">()</span>
<span class="n">timed_select_quicksort</span> <span class="o">=</span> <span class="n">calculate_time</span><span class="p">(</span><span class="n">select_quicksort</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">generate_running_times</span><span class="p">(</span><span class="n">max_size</span><span class="p">):</span>
    <span class="n">median_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">random_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">select_quicksort_rt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">median_quicksort_rt</span><span class="p">,</span>
        <span class="n">random_quicksort_rt</span><span class="p">,</span>
        <span class="n">quicksort_rt</span><span class="p">,</span>
        <span class="n">select_quicksort_rt</span>
    <span class="p">]</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">timed_median_quicksort</span><span class="p">,</span>
        <span class="n">timed_random_quicksort</span><span class="p">,</span>
        <span class="n">timed_quicksort</span><span class="p">,</span>
        <span class="n">timed_select_quicksort</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">generate_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">algorithms</span><span class="p">):</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">algorithm</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
    <span class="n">array_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">array_sizes</span><span class="p">,</span> <span class="n">measurements</span>
        
<span class="n">x</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">generate_running_times</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color_index</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">color_index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/recursive_sorting_and_data_structures_63_0.png" src="../../_images/recursive_sorting_and_data_structures_63_0.png" />
</div>
</div>
<p>Here we have:</p>
<ul class="simple">
<li><p>select_quicksort in red</p></li>
<li><p>median_quicksort in blue</p></li>
<li><p>quicksort in orange</p></li>
<li><p>random_quicksort in green</p></li>
</ul>
<p>Clearly our select algorithm does no better to improve our running time and in fact, makes things much worse.  This is probably because</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./02/2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../1/basic_sorting_and_recursion.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Basic Sorting</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>